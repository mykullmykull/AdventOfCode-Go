Same as part1, except when parsing we need to expand the map
